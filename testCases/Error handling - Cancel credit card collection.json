{
  "name": "3e6aab7c-c29c-40bb-ac3e-ab7479faca1f",
  "tags": [ "#purchase" ],
  "displayName": "Error handling - Cancel credit card collection",
  "notes": "Verifies that the user can change their mind when deciding to use a different credit card for their purchase, and use the credit card number already on file. This test case uses the purchase flow to start the credit card collection process.",
  "testCaseConversationTurns": [ {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Hello"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true
      },
      "triggeredIntent": {
        "name": "Default Welcome Intent"
      },
      "currentPage": {
        "name": "Main Menu",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "Hi! I'm the virtual retail agent. I can help you manage your account, check on your orders, search for stores, and purchase items. How can I assist you today?" ]
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "I'd like to buy something"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "retail.purchase_item_initiate"
      },
      "currentPage": {
        "name": "Check Login",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Of course, I am happy to assist with that. Would you like to login or continue as a guest?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Log in"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.user_login"
      },
      "currentPage": {
        "name": "Clarify Phone Number",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I'll need to verify your account first." ]
      }, {
        "text": [ "Are you calling from the same number that's registered with your account?" ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Request to send PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "Alright, I've verified your phone number." ]
      }, {
        "text": [ "I'll need to authenticate you. Can I send a PIN to your phone? Standard message charges may apply." ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Collect PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I've sent a 4 digit PIN to your phone." ]
      }, {
        "text": [ "Please provide the PIN you received, either by saying it or entering it into your keypad." ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "1234"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "pin_number": 1234
      },
      "currentPage": {
        "name": "Add to Cart",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Thank you! I have verified your account." ]
      }, {
        "text": [ "What can i help you purchase today?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "A Pixel 5"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "retail.extract.add_item_cart"
      },
      "currentPage": {
        "name": "Add to Cart",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "I have added a Pixel 5 to the cart as well. Can I help you order anything else?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "No thanks"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.no"
      },
      "currentPage": {
        "name": "Ask to Use Existing Address",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Okay lets go ahead and begin checkout" ]
      }, {
        "text": [ "Looks like your cart has the following, Pixel 5." ]
      }, {
        "text": [ "Should I use the shipping address we have on file for you?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Ask to Use Existing Billing Details",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Would you like to use the credit card on file?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "No"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.no"
      },
      "currentPage": {
        "name": "Request Card Number",
        "flow": "Card Collection Flow"
      },
      "textResponses": [ {
        "text": [ "Whats your credit card number? Feel free to say it or use the keypad to enter it. " ]
      } ],
      "currentFlow": {
        "name": "Card Collection Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Never mind"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_completed_one_operation": true,
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": false,
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "small_talk.start_over"
      },
      "currentPage": {
        "name": "Main Menu",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "Can I help you with anything else?" ]
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  } ],
  "creationTime": {
    "seconds": 1607103968,
    "nanos": 616271000
  }
}
