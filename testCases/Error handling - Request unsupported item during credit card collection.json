{
  "name": "746fda1c-d63d-4025-8669-cd199a9e5c87",
  "tags": [ "#purchase" ],
  "displayName": "Error handling - Request unsupported item during credit card collection",
  "notes": "Verifies that if the user purchases a supported item, and then asks to purchase an unsupported item during the credit card collection process, then the agent responds appropriately with an error message. The agent stays on the same page and re-prompts the user to continue filling out their credit card information.",
  "testCaseConversationTurns": [ {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Hello"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true
      },
      "triggeredIntent": {
        "name": "Default Welcome Intent"
      },
      "currentPage": {
        "name": "Main Menu",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "Hi! I'm the virtual retail agent. I can help you manage your account, check on your orders, search for stores, and purchase items. How can I assist you today?" ]
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "I'd like to buy something"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "retail.purchase_item_initiate"
      },
      "currentPage": {
        "name": "Check Login",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Of course, I am happy to assist with that. Do you have an account you would like to login to, or would you prefer to continue as a guest?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Log in "
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.user_login"
      },
      "currentPage": {
        "name": "Clarify Phone Number",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I'll need to verify your account first." ]
      }, {
        "text": [ "Is this the same phone number that's registered with your account?" ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Request to send PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "Thanks, I have verified your phone number." ]
      }, {
        "text": [ "I'll need to authenticate you with a PIN sent to your phone. May I send it? Standard message charges may apply." ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Collect PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I've sent a 4 digit PIN to your phone." ]
      }, {
        "text": [ "May I have the PIN you received? You can either say it or use your keypad." ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "1234"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "pin_number": 1234
      },
      "currentPage": {
        "name": "Add to Cart",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Alright, I was able to verify your account." ]
      }, {
        "text": [ "What can I help you purchase today?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "A Pixel 5"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "retail.extract.add_item_cart"
      },
      "currentPage": {
        "name": "Add to Cart",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Great, I have added a Pixel 5 to the cart for you. Is there anything else you would like?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "No thanks"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.no"
      },
      "currentPage": {
        "name": "Ask to Use Existing Address",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Okay lets go ahead and begin checkout" ]
      }, {
        "text": [ "Looks like your cart has the following, Pixel 5." ]
      }, {
        "text": [ "Should I send your purchases to your address on file?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Ask to Use Existing Billing Details",
        "flow": "Purchase Item Flow"
      },
      "textResponses": [ {
        "text": [ "Would you like to use the credit card on file?" ]
      } ],
      "currentFlow": {
        "name": "Purchase Item Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "No"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.no"
      },
      "currentPage": {
        "name": "Request Card Number",
        "flow": "Card Collection Flow"
      },
      "textResponses": [ {
        "text": [ "Whats your credit card number? Feel free to say it or use the keypad to enter it. " ]
      } ],
      "currentFlow": {
        "name": "Card Collection Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Can I buy a hat"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "cart": "Pixel 5",
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Purchase Item",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "retail.unsupported_item_request"
      },
      "currentPage": {
        "name": "Request Card Number",
        "flow": "Card Collection Flow"
      },
      "textResponses": [ {
        "text": [ "I'm sorry, we don't sell that item." ]
      }, {
        "text": [ "Can I have your card number please? You can say it or use the keypad to enter it." ]
      } ],
      "currentFlow": {
        "name": "Card Collection Flow"
      }
    }
  } ],
  "creationTime": {
    "seconds": 1607378179,
    "nanos": 672579000
  }
}
