{
  "name": "ddef506a-93af-40ff-a57b-0d1afc6f7938",
  "tags": [ "#switchflows", "#orders", "#cancelorder", "#account", "#replacecard" ],
  "displayName": "Error handling - Switch from cancel order to replace loyalty card during authentication",
  "notes": "Verifies that the user can start the flow to replace their loyalty card after first requesting to cancel an existing order The switch occurs at the start of the authentication process.",
  "testCaseConversationTurns": [ {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Hello"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true
      },
      "triggeredIntent": {
        "name": "Default Welcome Intent"
      },
      "currentPage": {
        "name": "Main Menu",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "Hi! I'm the virtual retail agent. I can help you manage your account, check on your orders, search for stores, and purchase items. How can I assist you today?" ]
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "I need to cancel an order"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Cancel Order",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "retail.cancel_order_initiate"
      },
      "currentPage": {
        "name": "Clarify Phone Number",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I can definitely look into that. " ]
      }, {
        "text": [ "I'll need some account information first." ]
      }, {
        "text": [ "Is the phone number you're calling from the same one that was used with your account?" ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Actually I need to replace my card"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "allow_guest_login": false,
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Replace Card",
        "operation_complete": false,
        "reset": true
      },
      "triggeredIntent": {
        "name": "retail.replace_loyalty_card_initiate"
      },
      "currentPage": {
        "name": "Clarify Phone Number",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I'll need to verify your account first." ]
      }, {
        "text": [ "Is the phone number you're calling from the same one that was used with your account?" ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "allow_guest_login": false,
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Replace Card",
        "operation_complete": false,
        "reset": true
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Request to send PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "Alright, I've verified your phone number." ]
      }, {
        "text": [ "I'll need to authenticate you with a PIN sent to your phone. May I send it? Standard message charges may apply." ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "allow_guest_login": false,
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Replace Card",
        "operation_complete": false,
        "reset": true
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Collect PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I've sent a 4 digit PIN to your phone." ]
      }, {
        "text": [ "May I have the PIN you received? You can either say it or use your keypad." ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "1234"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation_complete": false,
        "pin_number": 1234
      },
      "currentPage": {
        "name": "Verify Delivery Address",
        "flow": "Card Replacement Flow"
      },
      "textResponses": [ {
        "text": [ "Alright, I was able to verify your account." ]
      }, {
        "text": [ "I'll need to verify your delivery address before sending a new card. Are you still at 1600 Amphitheatre Parkway, Mountain View, CA 94043?" ]
      } ],
      "currentFlow": {
        "name": "Card Replacement Flow"
      }
    }
  } ],
  "creationTime": {
    "seconds": 1607116343,
    "nanos": 99598000
  }
}
