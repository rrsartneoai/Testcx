{
  "name": "2c999167-55ee-45eb-a74a-01d5057ffa17",
  "tags": [ "#orders", "#account", "#switchflows", "#cancelorder" ],
  "displayName": "Error handling - Switch from manage account to cancel order",
  "notes": "Verifies that the user can successfully cancel an existing order after first requesting to manage their account. The switch occurs after the user enters a PIN, but before they clarify how they would like to manage their account. When prompted, the user provides an order number, instead of saying the request is for the most recent order.",
  "testCaseConversationTurns": [ {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Hello"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true
      },
      "triggeredIntent": {
        "name": "Default Welcome Intent"
      },
      "currentPage": {
        "name": "Main Menu",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "Hi! I'm the virtual retail agent. I can help you manage your account, check on your orders, search for stores, and purchase items. How can I assist you today?" ]
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Manage my account"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "allow_guest_login": false,
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Manage Account",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "retail.manage_account_initiate"
      },
      "currentPage": {
        "name": "Clarify Phone Number",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I'll need to verify your account first." ]
      }, {
        "text": [ "Are you calling from the same number that's registered with your account?" ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "allow_guest_login": false,
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Manage Account",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Request to send PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "Okay, your phone number has been verified." ]
      }, {
        "text": [ "I'll need to authenticate you with a PIN sent to your phone. May I send it? Standard message charges may apply." ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "allow_guest_login": false,
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Manage Account",
        "operation_complete": false
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Collect PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I've sent a 4 digit PIN to your phone." ]
      }, {
        "text": [ "Could you please give me the PIN you received? You can say it or enter it into the keypad." ]
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "1234"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Manage Account",
        "operation_complete": false,
        "pin_number": 1234
      },
      "currentPage": {
        "name": "Manage Account",
        "flow": "Account Management Flow"
      },
      "textResponses": [ {
        "text": [ "Thanks! I've verified your account." ]
      }, {
        "text": [ "I'm ready to help you with your account. What do you need?" ]
      } ],
      "currentFlow": {
        "name": "Account Management Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Actually can I cancel my order"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Cancel Order",
        "operation_complete": false,
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "retail.cancel_order_initiate"
      },
      "currentPage": {
        "name": "Check Recent Order",
        "flow": "Order Management Flow"
      },
      "textResponses": [ {
        "text": [ "I can definitely look into that. " ]
      }, {
        "text": [ "Is this in regards to your recent order of the Google Home?" ]
      } ],
      "currentFlow": {
        "name": "Order Management Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "No"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Cancel Order",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.no"
      },
      "currentPage": {
        "name": "Check Order Number",
        "flow": "Order Management Flow"
      },
      "textResponses": [ {
        "text": [ "Can you tell me your order number, please? Alternatively, you can type it in and press pound." ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Order Management Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "1234"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Cancel Order",
        "operation_complete": false,
        "order_number": "1234",
        "order_unit": "Pixel 5",
        "pin_number": 1234
      },
      "currentPage": {
        "name": "Cancel Order",
        "flow": "Order Management Flow"
      },
      "textResponses": [ {
        "text": [ "Give me a minute to look that up for you" ]
      }, {
        "text": [ "I was able to find your order for the Pixel 5. Do you want me to go ahead and Cancel the order?" ]
      } ],
      "currentFlow": {
        "name": "Order Management Flow"
      }
    }
  } ],
  "creationTime": {
    "seconds": 1607107562,
    "nanos": 1336000
  }
}
