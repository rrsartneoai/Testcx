{
  "name": "9d4d37cf-a58b-43dd-b71b-fe3af2ab3994",
  "tags": [ "#orders", "#shippingaddress", "#switchflows" ],
  "displayName": "Error Handling - Switch flows to cancel order from updating a shipping address for an order",
  "notes": "User tries to edit shipping address. In the middle of the address collection the user switches flows to cancel an order. ",
  "testCaseConversationTurns": [ {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "I want to edit the shipping address for my pixel 5 order"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Edit Shipping Address",
        "operation_complete": false,
        "order_unit": "Pixel 5"
      },
      "triggeredIntent": {
        "name": "retail.edit_shipping_address_initiate"
      },
      "currentPage": {
        "name": "Clarify Phone Number",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "Sure, no problem. " ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "First, let me verify your account details." ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Is the phone number you're calling from the same one that was used with your account?" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Edit Shipping Address",
        "operation_complete": false,
        "order_unit": "Pixel 5"
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Request to send PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "Thanks, I have verified your phone number." ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "I'll need to authenticate you with a PIN sent to your phone. May I send it? Standard message charges may apply." ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_returning": true,
        "operation": "Edit Shipping Address",
        "operation_complete": false,
        "order_unit": "Pixel 5"
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Collect PIN",
        "flow": "User Verification Flow"
      },
      "textResponses": [ {
        "text": [ "I have sent a 4 digit PIN to your phone. May I have the PIN you received? You can either say it or use your keypad." ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "User Verification Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "3405"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Edit Shipping Address",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": "3405"
      },
      "currentPage": {
        "name": "Request User Location",
        "flow": "Address Collection Flow"
      },
      "textResponses": [ {
        "text": [ "Thank you! I have verified your account." ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "The order has not shipped yet, so I can update the shipping address for you." ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "What is your street address?" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Address Collection Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "345 spear street"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "location": {
          "original": "345 spear street",
          "street-address": "345 spear street"
        },
        "operation": "Edit Shipping Address",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": "3405"
      },
      "currentPage": {
        "name": "Request Zip Code",
        "flow": "Address Collection Flow"
      },
      "textResponses": [ {
        "text": [ "What's your zip code? You can say it out loud or type it in." ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Address Collection Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "On second thought I just want to cancel the order"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": true,
        "operation": "Cancel Order",
        "operation_complete": false,
        "order_unit": "Pixel 5",
        "pin_number": "3405",
        "reset": true
      },
      "triggeredIntent": {
        "name": "retail.cancel_order_initiate"
      },
      "currentPage": {
        "name": "Cancel Order",
        "flow": "Order Management Flow"
      },
      "textResponses": [ {
        "text": [ "Iâ€™ll be happy to help!" ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "I was able to find your order for the Pixel 5. Do you want me to go ahead and cancel the order?" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Order Management Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "Yes please"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_completed_one_operation": true,
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": false,
        "operation_complete": false,
        "pin_number": "3405",
        "reset": true
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.yes"
      },
      "currentPage": {
        "name": "Main Menu",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "I have cancelled the order for you. You should receive a confirmation email soon. " ],
        "allowPlaybackInterruption": true
      }, {
        "text": [ "Is there anything else you need help with?" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  }, {
    "userInput": {
      "isWebhookEnabled": true,
      "input": {
        "text": {
          "text": "No thank you"
        },
        "languageCode": "en"
      }
    },
    "virtualAgentOutput": {
      "sessionParameters": {
        "has_completed_one_operation": true,
        "has_welcomed_user": true,
        "is_guest": false,
        "is_logged_in": true,
        "is_returning": false,
        "operation_complete": false,
        "pin_number": "3405",
        "reset": true
      },
      "triggeredIntent": {
        "name": "small_talk.confirmation.no"
      },
      "currentPage": {
        "name": "End Session",
        "flow": "Default Start Flow"
      },
      "textResponses": [ {
        "text": [ "In that case, thank you for calling. Goodbye!" ],
        "allowPlaybackInterruption": true
      } ],
      "currentFlow": {
        "name": "Default Start Flow"
      }
    }
  } ],
  "creationTime": {
    "seconds": 1607555460,
    "nanos": 885596000
  }
}
